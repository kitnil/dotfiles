prometheus:
  prometheusSpec:
    resources:
      limits:
        cpu: 1
        memory: 512Mi
      requests:
        cpu: 1
        memory: 256Mi
    additionalScrapeConfigs:
    - static_configs:
      - targets:
        - 192.168.0.1
      scrape_interval: 10s
      job_name: tp-link
      relabel_configs:
      - source_labels:
        - __address__
        target_label: __param_target
      - source_labels:
        - __param_target
        target_label: instance
      - replacement: 192.168.0.145:9101
        target_label: __address__
    - static_configs:
      - targets:
        - 192.168.0.145:9633
      scrape_interval: 10m
      job_name: smartctl
    - static_configs:
      - targets:
        - vm1.wugi.info:9324
      scrape_interval: 1m
      job_name: bird
    - static_configs:
      - targets:
        - vm1.wugi.info:9636
      scrape_interval: 1m
      job_name: exim
    - static_configs:
      - targets:
        - vm1.wugi.info:9100
        - vm2.wugi.info:9100
        - notebook.wugi.info:9100
      scrape_interval: 5s
      job_name: node
    - static_configs:
      - targets:
        - 192.168.0.145:9153
      honor_labels: true
      job_name: dnsmasq
    - static_configs:
      - targets:
        - https://wugi.info/
        - https://guix.wugi.info/
        - https://blog.wugi.info/
        - https://peertube.home.wugi.info/
        - http://ci.guix.gnu.org.intr
        - http://ci.guix.gnu.org.wugi.info
        - https://ci.guix.gnu.org
        - https://bordeaux.guix.gnu.org
      scrape_interval: 30s
      metrics_path: /probe
      params:
        module:
        - http_2xx
      relabel_configs:
      - source_labels:
        - __address__
        target_label: __param_target
      - source_labels:
        - __param_target
        target_label: instance
      - replacement: 192.168.0.145:9115
        target_label: __address__
      job_name: http
    - static_configs:
      - targets:
        - 192.168.0.1
        - 81.95.28.27
        - 78.108.80.230
        - 78.108.87.250
        - 78.108.91.250
        - 172.16.103.1
        - ci.guix.gnu.org
      scrape_interval: 30s
      metrics_path: /probe
      params:
        module:
        - icmp
      relabel_configs:
      - source_labels:
        - __address__
        target_label: __param_target
      - source_labels:
        - __param_target
        target_label: instance
      - replacement: 127.0.0.1:9115
        target_label: __address__
      job_name: icmp
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      acme.cert-manager.io/http01-ingress-class: nginx
      cert-manager.io/cluster-issuer: letsencrypt
      nginx.ingress.kubernetes.io/whitelist-source-range: "10.0.0.0/8,192.168.0.0/16"
    tls:
    - secretName: prometheus-general-tls
      hosts:
      - prometheus.home.wugi.info
    hosts:
    - prometheus.home.wugi.info

alertmanager:
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      acme.cert-manager.io/http01-ingress-class: nginx
      cert-manager.io/cluster-issuer: letsencrypt
      nginx.ingress.kubernetes.io/whitelist-source-range: "10.0.0.0/8,192.168.0.0/16"
    tls:
    - secretName: alertmanager-general-tls
      hosts:
      - alertmanager.home.wugi.info
    hosts:
    - alertmanager.home.wugi.info

grafana:
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      acme.cert-manager.io/http01-ingress-class: nginx
      cert-manager.io/cluster-issuer: letsencrypt
      nginx.ingress.kubernetes.io/whitelist-source-range: "10.0.0.0/8,192.168.0.0/16"
    tls:
    - secretName: grafana-general-tls
      hosts:
      - grafana.home.wugi.info
    hosts:
    - grafana.home.wugi.info
  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
      - name: Prometheus Deprecated
        type: prometheus
        uid: prometheus-deprecated
        url: http://prometheus.wugi.info
        access: proxy
        isDefault: false
        jsonData:
          timeInterval: 30s

prometheus-node-exporter:
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: prometheus-node-exporter.cluster.local/schedulable
            operator: NotIn
            values:
            - "false"
          - key: kubernetes.io/os
            operator: NotIn
            values:
            - "windows"

kubeControllerManager:
  endpoints:
  - 192.168.154.1
  service:
    port: 10252
    targetPort: 10252
  serviceMonitor:
    https: 'true'
    insecureSkipVerify: 'true'

kubeScheduler:
  endpoints:
  - 192.168.154.1
  service:
    port: 10251
    targetPort: 10251
  serviceMonitor:
    https: 'true'
    insecureSkipVerify: 'true'

kubeEtcd:
  endpoints:
  - 192.168.154.1
