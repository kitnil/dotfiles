#!/bin/bash -e

SSH=/run/current-system/profile/bin/ssh

case "$1" in
    *.intr)
        host="$1"
        if [[ $# -eq 2 ]]
        then
            "$SSH" -t "$host" -- "set +o history; sudo --stdin --validate --prompt='' <<< $(pass show majordomo/ssh/eng); exec -a sudo sudo -i";
        else
            "$SSH" -q -t "$host" -- "set +o history; sudo --stdin --validate --prompt='' <<< $(pass show majordomo/ssh/eng); exec -a sudo sudo -i ${*:3}";
        fi
        ;;
    *)
        "$SSH" "$@"
        ;;
esac
