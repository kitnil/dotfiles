#!/usr/bin/env bash

set -e

config()
{
    while IFS= read -r -d '' directory
    do
        echo "$directory,$(basename "$(dirname "$directory")")-$(basename "$directory")"
    done < <(find "$HOME/majordomo" -maxdepth 2 -type d -print0)
}

cat > "$HOME/.config/gita/repo_path" <<EOF
$(config)
EOF

case "$1" in
    week)
        exec -a "$0" gita super log --format="%ai %H %s" --date=relative --since="${2:-1} weeks ago" "${@:2}"
        ;;
    *)
        exec -a "$0" sshpass -Ppassphrase -p"$(pass show gitlab.intr/ssh/id_rsa_gitlab_intr)" gita "$@"
        ;;
esac
