#!/usr/bin/env bash

set -eu
set -o pipefail

case "$1" in
    mjru)
        ss -o state listening '( dport = 59588 or sport = 59588 )' | grep -q :59588 \
            || ssh -fNL 59588:localhost:5901 majordomo
        vncviewer -PasswordFile ~/.vnc/passwd -NoJpeg localhost:59588
        ;;
    vm)
        ss -o state listening '( dport = 5911 or sport = 5911 )' | grep -q :5911 \
            || ssh -fNL 5911:localhost:5901 guix.vm.wugi.info
        vncviewer -AutoSelect=0 -PreferredEncoding=Raw -FullColor=1 -NoJPEG=1 -CompressLevel=0 -passwd ~/.vnc/passwd 127.0.0.1:5911
        ;;
    server)
        case "$2" in
            5901)
                vncserver -xstartup "$HOME/.vnc/xstartup" :1
                ;;
            5902)
                vncserver -geometry 1920x1080 -xstartup "$HOME/.vnc/xstartup-stumpwm" :2
                ;;
            5903)
                vncserver -geometry 1366x768 -xstartup "$HOME/.vnc/xstartup-stumpwm" :3
                ;;
        esac

        ;;
esac
