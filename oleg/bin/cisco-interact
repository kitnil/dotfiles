#! /usr/bin/env cached-nix-shell
#! nix-shell -i python3 -p python python3Packages.pexpect

import os
import sys
import pexpect

telnet_password = os.environ['TELNET_PASSWORD']
enable_password = os.environ['ENABLE_PASSWORD']

host = sys.argv[1]

command = " ".join(sys.argv[2:])

prompt = [host + ">", host + ".intr" + ">"]
child = pexpect.spawn("telnet " + host)
child.logfile = sys.stdout.buffer
# TODO: "/tmp/" + host + ".log"

child.expect("Password:")
child.sendline(telnet_password)

child.expect(prompt)
child.sendline("terminal length 0")

child.expect(prompt)

child.sendline("enable")
child.expect("Password:")
child.sendline(enable_password)

child.expect(host + "#")
child.logfile = None
# sys.stdout.write(prompt)
child.interact()

