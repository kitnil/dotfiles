apiVersion: batch/v1
kind: Job
metadata:
  name: configuration-to-version-control
spec:
  template:
    spec:
      containers:
      - name: state-to-git
        env:
        - name: HOME
          value: /home/oleg
        volumeMounts:
        - mountPath: /home/oleg/.gitconfig
          subPath: .gitconfig
          readOnly: true
          name: git-configuration
        - mountPath: /etc/passwd
          subPath: passwd
          readOnly: true
          name: rootfs
        - mountPath: /home/oleg/ansible-out
          name: output
        securityContext:
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsNonRoot: true
          runAsUser: 1000
          runAsGroup: 998
      volumes:
      - name: rootfs
        configMap:
          name: rootfs
      - name: git-configuration
        configMap:
          name: git-configuration
      - name: ssh-configuration
        configMap:
          name: ssh-configuration
      - name: ssh-password
        secret:
          secretName: ssh-password
      - name: output
        hostPath:
          path: /home/oleg/ansible-out
      restartPolicy: Never
  backoffLimit: 0
